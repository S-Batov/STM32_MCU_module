<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MCU_Module: PWM_timer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MCU_Module
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_p_w_m__timer_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">PWM_timer.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>PWM_timer functions needed to start the timer and DMA transfer.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_p_w_m__timer_8h_source.html">PWM_timer.h</a>&quot;</code><br />
<code>#include &quot;stm32g474xx.h&quot;</code><br />
<code>#include &quot;stm32g4xx_hal.h&quot;</code><br />
<code>#include &lt;math.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a597174ea5be6ca475ea0fddbef1e9af7" id="r_a597174ea5be6ca475ea0fddbef1e9af7"><td class="memItemLeft" align="right" valign="top"><a id="a597174ea5be6ca475ea0fddbef1e9af7" name="a597174ea5be6ca475ea0fddbef1e9af7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SINE_TABLE_SIZE</b>&#160;&#160;&#160;256</td></tr>
<tr class="memitem:a6d7324585adeb3bf8c86c3c63b03044f" id="r_a6d7324585adeb3bf8c86c3c63b03044f"><td class="memItemLeft" align="right" valign="top"><a id="a6d7324585adeb3bf8c86c3c63b03044f" name="a6d7324585adeb3bf8c86c3c63b03044f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PWM_MAX_DUTY</b>&#160;&#160;&#160;3999</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad15b750edc580421e24cc9ceffcbf449" id="r_ad15b750edc580421e24cc9ceffcbf449"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad15b750edc580421e24cc9ceffcbf449">PWM_timer_MOE_disable</a> (void)</td></tr>
<tr class="memdesc:ad15b750edc580421e24cc9ceffcbf449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main output disable.  <br /></td></tr>
<tr class="memitem:a2f3f12612d62785b9328eed6663f4860" id="r_a2f3f12612d62785b9328eed6663f4860"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f3f12612d62785b9328eed6663f4860">PWM_timer_MOE_enable</a> (void)</td></tr>
<tr class="memdesc:a2f3f12612d62785b9328eed6663f4860"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main output enable.  <br /></td></tr>
<tr class="memitem:a623ec857b272deb805c8d9393cd1dd15" id="r_a623ec857b272deb805c8d9393cd1dd15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a623ec857b272deb805c8d9393cd1dd15">PWM_timer_force_update</a> (void)</td></tr>
<tr class="memdesc:a623ec857b272deb805c8d9393cd1dd15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Force update event.  <br /></td></tr>
<tr class="memitem:a2370867eba6ee8d39d991cb18b1fe3ac" id="r_a2370867eba6ee8d39d991cb18b1fe3ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2370867eba6ee8d39d991cb18b1fe3ac">Generate3PhaseSineTable</a> (void)</td></tr>
<tr class="memdesc:a2370867eba6ee8d39d991cb18b1fe3ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the array for sine-waves.  <br /></td></tr>
<tr class="memitem:a6f050697881692fac68245160e88e231" id="r_a6f050697881692fac68245160e88e231"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6f050697881692fac68245160e88e231">PWM_timer_DMA_start</a> (void)</td></tr>
<tr class="memdesc:a6f050697881692fac68245160e88e231"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start DMA transfer for PWM timer.  <br /></td></tr>
<tr class="memitem:ac09c77c6da9ace3d0862a2b691cb1bba" id="r_ac09c77c6da9ace3d0862a2b691cb1bba"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac09c77c6da9ace3d0862a2b691cb1bba">PWM_timer_start</a> (void)</td></tr>
<tr class="memdesc:ac09c77c6da9ace3d0862a2b691cb1bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts PWM outputs on TIM8 with complementary channels.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5faa27108379f799afb6984010bf0384" id="r_a5faa27108379f799afb6984010bf0384"><td class="memItemLeft" align="right" valign="top"><a id="a5faa27108379f799afb6984010bf0384" name="a5faa27108379f799afb6984010bf0384"></a>
TIM_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>htim8</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>PWM_timer functions needed to start the timer and DMA transfer. </p>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a2370867eba6ee8d39d991cb18b1fe3ac" name="a2370867eba6ee8d39d991cb18b1fe3ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2370867eba6ee8d39d991cb18b1fe3ac">&#9670;&#160;</a></span>Generate3PhaseSineTable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Generate3PhaseSineTable </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the array for sine-waves. </p>
<p>Initialize values in sine_dma_buffer to create three sine-waves phase shifted by 120 deg </p>

</div>
</div>
<a id="a6f050697881692fac68245160e88e231" name="a6f050697881692fac68245160e88e231"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f050697881692fac68245160e88e231">&#9670;&#160;</a></span>PWM_timer_DMA_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef PWM_timer_DMA_start </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start DMA transfer for PWM timer. </p>
<p>Computes the PWM values needed to generate 3 sine-waves phase shifted by 120 deg. Starts the DMA transfer from the array with computed values and PWM timer CCR register. This produces 3 sine-waves shifted by 120 deg on the PWM timer output pins, without any software overhead.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_StatusTypeDef<ul>
<li>HAL_OK: DMA started successfully</li>
<li>HAL_ERROR: Failure in starting DMA channels</li>
</ul>
</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This function should be called before starting the PWM output to avoid static values in the CCR register. Any reconfiguration of the DMA channels should be done with MOE disabled to prevent glitches or incorrect output during the transition. </dd></dl>

</div>
</div>
<a id="a623ec857b272deb805c8d9393cd1dd15" name="a623ec857b272deb805c8d9393cd1dd15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a623ec857b272deb805c8d9393cd1dd15">&#9670;&#160;</a></span>PWM_timer_force_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PWM_timer_force_update </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Force update event. </p>
<p>Forces an update event by setting the TIM8 EGR register bit UG to 1, in order to update the ARR, CCR and BDTR registers with initial values.</p>
<p>As per RM0440 chapter 29.6.6: This bit can be set by software, it is automatically cleared by hardware.</p><ul>
<li>0: No action</li>
<li>1: Reinitialize the counter and generates an update of the registers</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Usage of this function is required before setting MOE to avoid causing a STP fault on first cycle (due to no dead time) </dd></dl>

</div>
</div>
<a id="ad15b750edc580421e24cc9ceffcbf449" name="ad15b750edc580421e24cc9ceffcbf449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad15b750edc580421e24cc9ceffcbf449">&#9670;&#160;</a></span>PWM_timer_MOE_disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PWM_timer_MOE_disable </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main output disable. </p>
<p>Disables the PWM_timer output to MCU pins by setting the BDTR register bit MOE to 0.</p>
<p>As per RM0440 chapter 29.6.20:</p><ul>
<li>0: OC and OCN outputs are disabled or forced to idle state depending on the OSSI bit.</li>
<li>1: OC and OCN outputs are enabled if their respective enable bits are set</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This doesn't stop the timer or PWM generation within the MCU, only disables the generated PWM to be output to the MCU pins. The timer will keep running and generating update/break interrupts. </dd></dl>

</div>
</div>
<a id="a2f3f12612d62785b9328eed6663f4860" name="a2f3f12612d62785b9328eed6663f4860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f3f12612d62785b9328eed6663f4860">&#9670;&#160;</a></span>PWM_timer_MOE_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PWM_timer_MOE_enable </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main output enable. </p>
<p>Enables the PWM_timer output to MCU pins by setting the BDTR register bit MOE to 1.</p>
<p>As per RM0440 chapter 29.6.20:</p><ul>
<li>0: OC and OCN outputs are disabled or forced to idle state depending on the OSSI bit.</li>
<li>1: OC and OCN outputs are enabled if their respective enable bits are set </li>
</ul>

</div>
</div>
<a id="ac09c77c6da9ace3d0862a2b691cb1bba" name="ac09c77c6da9ace3d0862a2b691cb1bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac09c77c6da9ace3d0862a2b691cb1bba">&#9670;&#160;</a></span>PWM_timer_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef PWM_timer_start </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts PWM outputs on TIM8 with complementary channels. </p>
<p>This function performs the following steps:</p><ol type="1">
<li>Disables the Main Output Enable (MOE) to safely configure outputs.</li>
<li>Starts TIM8 base counter and all PWM channels (TIM_CHANNEL_1, 2, 3) including complementary outputs (N channels).</li>
<li>Enables update and break interrupts for the timer.</li>
<li>Forces an update event to correctly load dead time for the first cycle.</li>
<li>Re-enables MOE to allow PWM outputs to drive the power stage.</li>
</ol>
<p>If any HAL start function fails, all channels are stopped and MOE is disabled, returning HAL_ERROR.</p>
<dl class="section return"><dt>Returns</dt><dd>HAL_StatusTypeDef<ul>
<li>HAL_OK: PWM started successfully</li>
<li>HAL_ERROR: Failure in starting timer or PWM channels </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li><li class="navelem"><a href="_p_w_m__timer_8c.html">PWM_timer.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
